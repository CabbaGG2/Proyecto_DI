<!DOCTYPE html>

<html lang="es" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>main &#8212; documentación de Gestión de Biblioteca - 1.0</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <script src="../_static/documentation_options.js?v=4936afed"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=f85f4cfb"></script>
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Código fuente para main</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">gi</span>
<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Esto evita que la documentación falle si no encuentra GTK</span>
    <span class="n">gi</span><span class="o">.</span><span class="n">require_version</span><span class="p">(</span><span class="s1">&#39;Gtk&#39;</span><span class="p">,</span> <span class="s1">&#39;3.0&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">gi.repository</span><span class="w"> </span><span class="kn">import</span> <span class="n">Gtk</span><span class="p">,</span> <span class="n">Pango</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">conexionBD</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConexionBD</span>


<div class="viewcode-block" id="BibliotecaApp">
<a class="viewcode-back" href="../main.html#main.BibliotecaApp">[documentos]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">BibliotecaApp</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Window</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clase que define la ventana principal de la aplicación de gestión de biblioteca.</span>

<span class="sd">    Esta clase hereda de Gtk.Window y se encarga de gestionar la interfaz de usuario</span>
<span class="sd">    y la interacción directa con la base de datos de libros.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inicializa la ventana principal, configura el diseño y establece la conexión</span>
<span class="sd">        inicial con la base de datos, asegurando la existencia de las tablas.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Gestión de Biblioteca Municipal&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_default_size</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_border_width</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

        <span class="c1"># Ruta de la base de datos</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Directorio actual: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">ruta_directorio</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ruta_directorio</span><span class="p">,</span> <span class="s2">&quot;biblioteca.db&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">ConexionBD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>

        <span class="c1"># CREAMOS LA TABLA SI NO EXISTE</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">conectaBD</span><span class="p">()</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            CREATE TABLE IF NOT EXISTS libros (</span>
<span class="s2">                id INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s2">                titulo TEXT NOT NULL,</span>
<span class="s2">                autor TEXT NOT NULL,</span>
<span class="s2">                xenero TEXT,</span>
<span class="s2">                disponible INTEGER</span>
<span class="s2">            )</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="c1"># -----------------------------------------------</span>

        <span class="c1"># Layout Principal</span>
        <span class="n">vbox</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Orientation</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vbox</span><span class="p">)</span>

        <span class="c1"># --- SECCIÓN SUPERIOR: FORMULARIO (Gtk.Frame) ---</span>
        <span class="n">frame_engadir</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Añadir Nuevo Libro&quot;</span><span class="p">)</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">column_spacing</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">row_spacing</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">frame_engadir</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">entry_titulo</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">placeholder_text</span><span class="o">=</span><span class="s2">&quot;Título del libro&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entry_autor</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">placeholder_text</span><span class="o">=</span><span class="s2">&quot;Autor&quot;</span><span class="p">)</span>

        <span class="c1"># ComboBox para Género</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">combo_xenero</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ComboBoxText</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Narrativa&quot;</span><span class="p">,</span> <span class="s2">&quot;Poesía&quot;</span><span class="p">,</span> <span class="s2">&quot;Ensayo&quot;</span><span class="p">,</span> <span class="s2">&quot;Ciencia Ficción&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">combo_xenero</span><span class="o">.</span><span class="n">append_text</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">combo_xenero</span><span class="o">.</span><span class="n">set_active</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># RadioButtons para estado</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radio_si</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">RadioButton</span><span class="o">.</span><span class="n">new_with_label</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Sí&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radio_no</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">RadioButton</span><span class="o">.</span><span class="n">new_with_label_from_widget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radio_si</span><span class="p">,</span> <span class="s2">&quot;No&quot;</span><span class="p">)</span>
        <span class="n">box_radio</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Orientation</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">box_radio</span><span class="o">.</span><span class="n">pack_start</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radio_si</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">box_radio</span><span class="o">.</span><span class="n">pack_start</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radio_no</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">grid</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Título:&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entry_titulo</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Autor:&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entry_autor</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Género:&quot;</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">combo_xenero</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Disponible:&quot;</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">box_radio</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">btn_engadir</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Guardar Libro&quot;</span><span class="p">)</span>
        <span class="n">btn_engadir</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;clicked&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_btn_engadir_clicked</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">btn_engadir</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">vbox</span><span class="o">.</span><span class="n">pack_start</span><span class="p">(</span><span class="n">frame_engadir</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># --- SECCIÓN CENTRAL: TREEVIEW (LISTA) ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ListStore</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treeview</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">TreeView</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">title</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;Título&quot;</span><span class="p">,</span> <span class="s2">&quot;Autor&quot;</span><span class="p">,</span> <span class="s2">&quot;Género&quot;</span><span class="p">,</span> <span class="s2">&quot;Disp.&quot;</span><span class="p">]):</span>
            <span class="n">renderer</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">CellRendererText</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>  <span class="c1"># Renderizado especial para booleano</span>
                <span class="n">renderer</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">CellRendererToggle</span><span class="p">()</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">TreeViewColumn</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">TreeViewColumn</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">treeview</span><span class="o">.</span><span class="n">append_column</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

        <span class="n">scroll</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ScrolledWindow</span><span class="p">()</span>
        <span class="n">scroll</span><span class="o">.</span><span class="n">set_vexpand</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">scroll</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treeview</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">pack_start</span><span class="p">(</span><span class="n">scroll</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># --- SECCIÓN INFERIOR: BOTONES CRUD ---</span>
        <span class="n">hbox_btns</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">spacing</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">btn_editar</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Editar Seleccionado&quot;</span><span class="p">)</span>
        <span class="n">btn_editar</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;clicked&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_btn_editar_clicked</span><span class="p">)</span>
        <span class="n">btn_borrar</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Eliminar Libro&quot;</span><span class="p">)</span>
        <span class="n">btn_borrar</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;clicked&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_btn_borrar_clicked</span><span class="p">)</span>

        <span class="n">hbox_btns</span><span class="o">.</span><span class="n">pack_start</span><span class="p">(</span><span class="n">btn_editar</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">hbox_btns</span><span class="o">.</span><span class="n">pack_start</span><span class="p">(</span><span class="n">btn_borrar</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">pack_start</span><span class="p">(</span><span class="n">hbox_btns</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">actualizar_lista</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_all</span><span class="p">()</span>

<div class="viewcode-block" id="BibliotecaApp.amosar_dialogo">
<a class="viewcode-back" href="../main.html#main.BibliotecaApp.amosar_dialogo">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">amosar_dialogo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tipo</span><span class="p">,</span> <span class="n">mensaxe</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Muestra un diálogo de información o error al usuario.</span>

<span class="sd">        :param tipo: El tipo de mensaje de GTK (Info, Error, Warning).</span>
<span class="sd">        :type tipo: Gtk.MessageType</span>
<span class="sd">        :param mensaxe: El texto del mensaje que se mostrará.</span>
<span class="sd">        :type mensaxe: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dialogo</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span>
            <span class="n">transient_for</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">message_type</span><span class="o">=</span><span class="n">tipo</span><span class="p">,</span>
            <span class="n">buttons</span><span class="o">=</span><span class="n">Gtk</span><span class="o">.</span><span class="n">ButtonsType</span><span class="o">.</span><span class="n">OK</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="n">mensaxe</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">dialogo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">dialogo</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span></div>


<div class="viewcode-block" id="BibliotecaApp.actualizar_lista">
<a class="viewcode-back" href="../main.html#main.BibliotecaApp.actualizar_lista">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">actualizar_lista</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Consulta todos los registros de la tabla &#39;libros&#39; y refresca el TreeView.</span>
<span class="sd">        Limpia el modelo de datos y lo vuelve a cargar desde la base de datos.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">conectaBD</span><span class="p">()</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM libros&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">fila</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
            <span class="n">lista_fila</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fila</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lista_fila</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">lista_fila</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">lista_fila</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lista_fila</span><span class="p">)</span></div>


<div class="viewcode-block" id="BibliotecaApp.on_btn_engadir_clicked">
<a class="viewcode-back" href="../main.html#main.BibliotecaApp.on_btn_engadir_clicked">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_btn_engadir_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Manejador del evento de clic en el botón guardar. Inserta un nuevo libro en la base de datos.</span>

<span class="sd">        :param widget: El componente que dispara el evento.</span>
<span class="sd">        :type widget: Gtk.Button</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">titulo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_titulo</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
        <span class="n">autor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_autor</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
        <span class="n">xenero</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">combo_xenero</span><span class="o">.</span><span class="n">get_active_text</span><span class="p">()</span>
        <span class="n">disp</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">radio_si</span><span class="o">.</span><span class="n">get_active</span><span class="p">()</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">titulo</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">autor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">amosar_dialogo</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">MessageType</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span> <span class="s2">&quot;El título y el autor son obligatorios.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">conectaBD</span><span class="p">()</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO libros (titulo, autor, xenero, disponible) VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span>
                       <span class="p">(</span><span class="n">titulo</span><span class="p">,</span> <span class="n">autor</span><span class="p">,</span> <span class="n">xenero</span><span class="p">,</span> <span class="n">disp</span><span class="p">))</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actualizar_lista</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amosar_dialogo</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">MessageType</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Libro añadido con éxito.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="BibliotecaApp.on_btn_borrar_clicked">
<a class="viewcode-back" href="../main.html#main.BibliotecaApp.on_btn_borrar_clicked">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_btn_borrar_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Elimina el libro seleccionado en el TreeView previa confirmación del usuario.</span>

<span class="sd">        :param widget: El componente que dispara el evento.</span>
<span class="sd">        :type widget: Gtk.Button</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">treeview</span><span class="o">.</span><span class="n">get_selection</span><span class="p">()</span>
        <span class="n">model</span><span class="p">,</span> <span class="n">treeiter</span> <span class="o">=</span> <span class="n">selection</span><span class="o">.</span><span class="n">get_selected</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">treeiter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">id_libro</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="n">treeiter</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">confirm</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="n">transient_for</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">message_type</span><span class="o">=</span><span class="n">Gtk</span><span class="o">.</span><span class="n">MessageType</span><span class="o">.</span><span class="n">QUESTION</span><span class="p">,</span>
                                        <span class="n">buttons</span><span class="o">=</span><span class="n">Gtk</span><span class="o">.</span><span class="n">ButtonsType</span><span class="o">.</span><span class="n">YES_NO</span><span class="p">,</span>
                                        <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;¿Seguro que quieres borrar el ID </span><span class="si">{</span><span class="n">id_libro</span><span class="si">}</span><span class="s2">?&quot;</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">confirm</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
            <span class="n">confirm</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">res</span> <span class="o">==</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">YES</span><span class="p">:</span>
                <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">conectaBD</span><span class="p">()</span>
                <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM libros WHERE id=?&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">id_libro</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">actualizar_lista</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">amosar_dialogo</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">MessageType</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span> <span class="s2">&quot;Selecciona un libro primero.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="BibliotecaApp.on_btn_editar_clicked">
<a class="viewcode-back" href="../main.html#main.BibliotecaApp.on_btn_editar_clicked">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_btn_editar_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtiene los datos del libro seleccionado y abre el diálogo de edición.</span>

<span class="sd">        :param widget: El componente que dispara el evento.</span>
<span class="sd">        :type widget: Gtk.Button</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">treeview</span><span class="o">.</span><span class="n">get_selection</span><span class="p">()</span>
        <span class="n">model</span><span class="p">,</span> <span class="n">treeiter</span> <span class="o">=</span> <span class="n">selection</span><span class="o">.</span><span class="n">get_selected</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">treeiter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">datos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="n">treeiter</span><span class="p">])</span>
            <span class="n">dialogo</span> <span class="o">=</span> <span class="n">EdicionDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datos</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">dialogo</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">res</span> <span class="o">==</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">OK</span><span class="p">:</span>
                <span class="n">novos_datos</span> <span class="o">=</span> <span class="n">dialogo</span><span class="o">.</span><span class="n">get_datos</span><span class="p">()</span>
                <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">conectaBD</span><span class="p">()</span>
                <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;UPDATE libros SET titulo=?, autor=?, xenero=? WHERE id=?&quot;</span><span class="p">,</span>
                               <span class="p">(</span><span class="n">novos_datos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">novos_datos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">novos_datos</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">datos</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">actualizar_lista</span><span class="p">()</span>
            <span class="n">dialogo</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="EdicionDialog">
<a class="viewcode-back" href="../main.html#main.EdicionDialog">[documentos]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">EdicionDialog</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Dialog</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clase que define un cuadro de diálogo para la edición de registros de libros.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">datos</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor del diálogo de edición.</span>

<span class="sd">        :param parent: Ventana padre de la que depende el diálogo.</span>
<span class="sd">        :type parent: Gtk.Window</span>
<span class="sd">        :param datos: Lista con los datos actuales del libro seleccionado.</span>
<span class="sd">        :type datos: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Editar Libro&quot;</span><span class="p">,</span> <span class="n">transient_for</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">STOCK_CANCEL</span><span class="p">,</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_button</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">STOCK_SAVE</span><span class="p">,</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span>

        <span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_content_area</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ent_t</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">datos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ent_a</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">datos</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ent_x</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">datos</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

        <span class="n">box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Nuevo Título:&quot;</span><span class="p">))</span>
        <span class="n">box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ent_t</span><span class="p">)</span>
        <span class="n">box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Nuevo Autor:&quot;</span><span class="p">))</span>
        <span class="n">box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ent_a</span><span class="p">)</span>
        <span class="n">box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Nuevo Género:&quot;</span><span class="p">))</span>
        <span class="n">box</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ent_x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_all</span><span class="p">()</span>

<div class="viewcode-block" id="EdicionDialog.get_datos">
<a class="viewcode-back" href="../main.html#main.EdicionDialog.get_datos">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_datos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recupera los valores introducidos por el usuario en los campos del diálogo.</span>

<span class="sd">        :return: Lista con el nuevo título, autor y género.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ent_t</span><span class="o">.</span><span class="n">get_text</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ent_a</span><span class="o">.</span><span class="n">get_text</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ent_x</span><span class="o">.</span><span class="n">get_text</span><span class="p">()]</span></div>
</div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">BibliotecaApp</span><span class="p">()</span>
    <span class="n">Gtk</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Gestión de Biblioteca</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Ir a" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navegación</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">src</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Código de módulo</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2026, CabbaGG.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>